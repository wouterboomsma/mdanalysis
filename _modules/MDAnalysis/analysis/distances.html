<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MDAnalysis.analysis.distances &mdash; MDAnalysis 0.15.1-dev0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.15.1-dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 0.15.1-dev0 documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
    <link rel="top" title="MDAnalysis 0.15.1-dev0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MDAnalysis 0.15.1-dev0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/mdanalysis-logo-200x150.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for MDAnalysis.analysis.distances</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; -*-</span>
<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>
<span class="c1">#</span>
<span class="c1"># MDAnalysis --- http://www.MDAnalysis.org</span>
<span class="c1"># Copyright (c) 2006-2014 Naveen Michaud-Agrawal,</span>
<span class="c1"># Elizabeth J. Denning, Oliver Beckstein,</span>
<span class="c1">#               and contributors (see AUTHORS for the full list)</span>
<span class="c1"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c1">#</span>
<span class="c1"># Please cite your use of MDAnalysis in published work:</span>
<span class="c1">#</span>
<span class="c1">#     N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and</span>
<span class="c1">#     O. Beckstein. MDAnalysis: A Toolkit for the Analysis of</span>
<span class="c1">#     Molecular Dynamics Simulations. J. Comput. Chem. 32 (2011), 2319--2327,</span>
<span class="c1">#     doi:10.1002/jcc.21787</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Distance analysis --- :mod:`MDAnalysis.analysis.distances`</span>
<span class="sd">==========================================================</span>

<span class="sd">This module provides functions to rapidly compute distances between</span>
<span class="sd">atoms or groups of atoms.</span>

<span class="sd">:func:`dist` and :func:`between` can take atom groups that do not even</span>
<span class="sd">have to be from the same :class:`~MDAnalysis.core.AtomGroup.Universe`.</span>

<span class="sd">.. SeeAlso:: :mod:`MDAnalysis.lib.distances` </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;distance_array&#39;</span><span class="p">,</span> <span class="s1">&#39;self_distance_array&#39;</span><span class="p">,</span> <span class="s1">&#39;contact_matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">MDAnalysis.lib.distances</span> <span class="kn">import</span> <span class="n">distance_array</span><span class="p">,</span> <span class="n">self_distance_array</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.lib.c_distances</span> <span class="kn">import</span> <span class="n">contact_matrix_no_pbc</span><span class="p">,</span> <span class="n">contact_matrix_pbc</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;MDAnalysis.analysis.distances&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
   <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
   <span class="n">sparse</span> <span class="o">=</span> <span class="bp">None</span>
   <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;scipy.sparse could not be imported: some functionality will &quot;</span> \
         <span class="s2">&quot;not be available in contact_matrix()&quot;</span>
   <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">ImportWarning</span><span class="p">)</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
   <span class="k">del</span> <span class="n">msg</span>

<div class="viewcode-block" id="contact_matrix"><a class="viewcode-back" href="../../../documentation_pages/analysis/distances.html#MDAnalysis.analysis.distances.contact_matrix">[docs]</a><span class="k">def</span> <span class="nf">contact_matrix</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">returntype</span><span class="o">=</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates a matrix of contacts.</span>

<span class="sd">    There is a fast, high-memory-usage version for small systems</span>
<span class="sd">    (*returntype* = &#39;numpy&#39;), and a slower, low-memory-usage version for</span>
<span class="sd">    larger systems (*returntype* = &#39;sparse&#39;).</span>

<span class="sd">    If *box* dimensions are passed then periodic boundary conditions</span>
<span class="sd">    are applied.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    coord : array</span>
<span class="sd">       Array of coordinates of shape ``(N, 3)`` and dtype float32.</span>
<span class="sd">    cutoff : float, optional, default 15</span>
<span class="sd">       Particles within `cutoff` are considered to form a contact.</span>
<span class="sd">    returntype : string, optional, default &quot;numpy&quot;</span>
<span class="sd">       Select how the contact matrix is returned.</span>
<span class="sd">       * ``&quot;numpy&quot;``: return as an ``(N. N)`` :class:`numpy.ndarray`</span>
<span class="sd">       * ``&quot;sparse&quot;``: return as a :class:`scipy.sparse.lil_matrix`</span>
<span class="sd">    box : array-like or ``None``, optional, default ``None``</span>
<span class="sd">       Simulation cell dimensions in the form of</span>
<span class="sd">       :attr:`MDAnalysis.trajectory.base.Timestep.dimensions` when</span>
<span class="sd">       periodic boundary conditions should be taken into account for</span>
<span class="sd">       the calculation of contacts.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array or sparse matrix</span>
<span class="sd">       The contact matrix is returned in a format determined by the `returntype`</span>
<span class="sd">       keyword.</span>


<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    :module:`scipy.sparse` is require for using *sparse* matrices; if it cannot</span>
<span class="sd">    be imported then an `ImportError` is raised.</span>

<span class="sd">    .. versionchanged:: 0.11.0</span>
<span class="sd">       Keyword *suppress_progmet* and *progress_meter_freq* were removed.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">returntype</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span><span class="p">:</span>
        <span class="n">adj</span> <span class="o">=</span> <span class="p">(</span><span class="n">distance_array</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">adj</span>
    <span class="k">elif</span> <span class="n">returntype</span> <span class="o">==</span> <span class="s2">&quot;sparse&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sparse</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># hack: if we are running with minimal dependencies then scipy was</span>
            <span class="c1">#       not imported and we have to bail here (see scipy import at top)</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;For sparse matrix functionality you need to &quot;</span>
                              <span class="s2">&quot;import scipy.&quot;</span><span class="p">)</span>
        <span class="c1"># Initialize square List of Lists matrix of dimensions equal to number</span>
        <span class="c1"># of coordinates passed</span>
        <span class="n">sparse_contacts</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">lil_matrix</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># with PBC</span>
            <span class="n">contact_matrix_pbc</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">sparse_contacts</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># without PBC</span>
            <span class="n">contact_matrix_no_pbc</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">sparse_contacts</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sparse_contacts</span></div>


<div class="viewcode-block" id="dist"><a class="viewcode-back" href="../../../documentation_pages/analysis/distances.html#MDAnalysis.analysis.distances.dist">[docs]</a><span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return distance between atoms in two atom groups.</span>

<span class="sd">    The distance is calculated atom-wise. The residue ids are also</span>
<span class="sd">    returned because a typical use case is to look at CA distances</span>
<span class="sd">    before and after an alignment. Using the `offset` keyword one can</span>
<span class="sd">    also add a constant offset to the resids which facilitates</span>
<span class="sd">    comparison with PDB numbering.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>

<span class="sd">    A, B: AtomGroup instances</span>
<span class="sd">       :class:`~MDAnalysis.core.AtomGroup.AtomGroup` with the</span>
<span class="sd">       same number of atoms</span>
<span class="sd">    offset : integer or tuple, optional, default 0</span>
<span class="sd">       An integer `offset` is added to *resids_A* and *resids_B* (see</span>
<span class="sd">       below) in order to produce PDB numbers.</span>

<span class="sd">       If `offset` is :class:`tuple` then ``offset[0]`` is added to</span>
<span class="sd">       *resids_A* and ``offset[1]`` to *resids_B*. Note that one can</span>
<span class="sd">       actually supply numpy arrays of the same length as the atom</span>
<span class="sd">       group so that an individual offset is added to each resid.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    resids_A : array</span>
<span class="sd">        residue ids of the `A` group (possibly changed with `offset`)</span>
<span class="sd">    resids_B : array</span>
<span class="sd">       residue ids of the `B` group (possibly changed with `offset`)</span>
<span class="sd">    distances : array</span>
<span class="sd">       distances between the atoms</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">!=</span> <span class="n">B</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;AtomGroups A and B do not have the same number of atoms&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">off_A</span><span class="p">,</span> <span class="n">off_B</span> <span class="o">=</span> <span class="n">offset</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">off_A</span> <span class="o">=</span> <span class="n">off_B</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
    <span class="n">residues_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">resids</span><span class="p">)</span> <span class="o">+</span> <span class="n">off_A</span>
    <span class="n">residues_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">resids</span><span class="p">)</span> <span class="o">+</span> <span class="n">off_B</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">residues_A</span><span class="p">,</span> <span class="n">residues_B</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span></div>


<span class="k">def</span> <span class="nf">between</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return sub group of `group` that is within `distance` of both `A` and `B`</span>

<span class="sd">    This function is not aware of periodic boundary conditions.</span>

<span class="sd">    Can be used to find bridging waters or molecules in an interface.</span>

<span class="sd">    Similar to &quot;*group* and (AROUND *A* *distance* and AROUND *B* *distance*)&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    group : AtomGroup</span>
<span class="sd">        Find members of `group` that are between `A` and `B`</span>
<span class="sd">    A, B : AtomGroups</span>
<span class="sd">        `A` and `B` are :class:`~MDAnalysis.core.AtomGroup.AtomGroup`</span>
<span class="sd">        instances.  Works best if `group` is bigger than either `A` or</span>
<span class="sd">        `B`.</span>
<span class="sd">    distance : float</span>
<span class="sd">        maximum distance for an atom to be counted as in the vicinity of</span>
<span class="sd">        `A` or `B`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    AtomGroup</span>
<span class="sd">       :class:`~MDAnalysis.core.AtomGroup.AtomGroup` of atoms that</span>
<span class="sd">       fulfill the criterion</span>

<span class="sd">    .. versionadded: 0.7.5</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">MDAnalysis.core.AtomGroup</span> <span class="kn">import</span> <span class="n">AtomGroup</span>

    <span class="n">ns_group</span> <span class="o">=</span> <span class="n">AtomNeighborSearch</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="n">resA</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ns_group</span><span class="o">.</span><span class="n">search_list</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">distance</span><span class="p">))</span>
    <span class="n">resB</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ns_group</span><span class="o">.</span><span class="n">search_list</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">distance</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">AtomGroup</span><span class="p">(</span><span class="n">resB</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">resA</span><span class="p">))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MDAnalysis 0.15.1-dev0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2005-2015, Naveen Michaud-Agrawal, Elizabeth J. Denning, Christian Beckstein (logo), Joshua L. Adelman, Balasubramanian, Jonathan Barnoud, Alejandro Bernardin, Bart Bruininks, SÃ©bastien Buchoux, David Caplan, Matthieu Chavent, John Detlefs, Xavier Deupi, Jan Domanski, David L. Dotson, Lennard van der Feltz, Philip Fowler, Joseph Goose, Richard J. Gowers, Lukas Grossar, Abhinav Gupta, Benjamin Hall, Kyle J. Huston, Joe Jordan, Max Linke, Jinju Lu, Robert McGibbon, Manuel Nuno Melo, Alex Nesterenko, Hai Nguyen, Mattia F. Palermo, Danny Parton, Joshua L. Phillips, Tyler Reddy, Paul Rigor, Carlos Yanez S., Utkarsh Saxena, Sean L. Seyler, Andy Somogyi, Caio S. Souza, Lukas Stelzl, Gorman Stock, Isaac Virshup, Zhuyi Xue, and Oliver Beckstein.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>