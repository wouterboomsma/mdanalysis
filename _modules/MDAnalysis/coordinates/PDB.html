<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MDAnalysis.coordinates.PDB &mdash; MDAnalysis 0.14.1-dev0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.14.1-dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 0.14.1-dev0 documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
    <link rel="top" title="MDAnalysis 0.14.1-dev0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MDAnalysis 0.14.1-dev0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/mdanalysis-logo-200x150.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for MDAnalysis.coordinates.PDB</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>
<span class="c1">#</span>
<span class="c1"># MDAnalysis --- http://www.MDAnalysis.org</span>
<span class="c1"># Copyright (c) 2006-2015 Naveen Michaud-Agrawal, Elizabeth J. Denning, Oliver</span>
<span class="c1"># Beckstein and contributors (see AUTHORS for the full list)</span>
<span class="c1">#</span>
<span class="c1"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c1">#</span>
<span class="c1"># Please cite your use of MDAnalysis in published work:</span>
<span class="c1">#</span>
<span class="c1"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c1"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c1">#</span>


<span class="sd">&quot;&quot;&quot;PDB structure files in MDAnalysis --- :mod:`MDAnalysis.coordinates.PDB`</span>
<span class="sd">========================================================================</span>

<span class="sd">MDAnalysis reads coordinates from PDB files and additional optional</span>
<span class="sd">data such as B-factors. It is also possible to substitute a PDB file</span>
<span class="sd">instead of PSF file in order to define the list of atoms (but no</span>
<span class="sd">connectivity information will be available in this case).</span>

<span class="sd">PDB files contain both coordinate and atom information. It is also possible to</span>
<span class="sd">write trajectories as multi-frame (or multi-model) PDB files. This is not very</span>
<span class="sd">space efficient but is sometimes the lowest common denominator for exchanging</span>
<span class="sd">trajectories. Single frame and multi-frame PDB files are automatically</span>
<span class="sd">recognized; the only difference is thath the single-frame PDB is represented as</span>
<span class="sd">a trajectory with only one frame.</span>

<span class="sd">In order to write a selection to a PDB file one typically uses the</span>
<span class="sd">:meth:`MDAnalysis.core.AtomGroup.AtomGroup.write` method of the selection::</span>

<span class="sd">  calphas = universe.select_atoms(&quot;name CA&quot;)</span>
<span class="sd">  calphas.write(&quot;calpha_only.pdb&quot;)</span>

<span class="sd">This uses the coordinates from the current timestep of the trajectory.</span>

<span class="sd">In order to write a PDB trajectory one needs to first obtain a multi-frame</span>
<span class="sd">writer (keyword *multiframe* = ``True``) and then iterate through the</span>
<span class="sd">trajectory, while writing each frame::</span>

<span class="sd">  calphas = universe.select_atoms(&quot;name CA&quot;)</span>
<span class="sd">  W = MDAnalysis.Writer(&quot;calpha_traj.pdb&quot;, multiframe=True)</span>
<span class="sd">  for ts in u.trajectory:</span>
<span class="sd">      W.write(calphas)</span>
<span class="sd">  W.close()</span>

<span class="sd">It is important to *always close the trajectory* when done because only at this</span>
<span class="sd">step is the final END_ record written, which is required by the `PDB</span>
<span class="sd">standard`_.</span>


<span class="sd">Implementations</span>
<span class="sd">---------------</span>

<span class="sd">PDB I/O is available in the form of the Simple PDB Reader/Writers.</span>

<span class="sd">..deprecated:: 0.15.0</span>
<span class="sd">Readers and writers solely available in the form of</span>
<span class="sd">Simple Readers and Writers, see below.</span>

<span class="sd">Simple PDB Reader and Writer</span>
<span class="sd">-----------------------------------------</span>
<span class="sd">A pure-Python implementation for PDB files commonly encountered in MD</span>
<span class="sd">simulations comes under the names :class:`PDBReader` and</span>
<span class="sd">:class:`PDBWriter`. It only implements a subset of the `PDB standard`_</span>
<span class="sd">(for instance, it does not deal with insertion codes) and also allows some</span>
<span class="sd">typical enhancements such as 4-letter resids (introduced by CHARMM/NAMD).</span>

<span class="sd">The :class:`PDBReader` can read multi-frame PDB files and represents</span>
<span class="sd">them as a trajectory. The :class:`PDBWriter` can write single and</span>
<span class="sd">multi-frame PDB files as specified by the *multiframe* keyword. By default, it</span>
<span class="sd">writes single frames. On the other hand, the :class:`MultiPDBWriter` is set up</span>
<span class="sd">to write a PDB trajectory by default (equivalent to using *multiframe* =</span>
<span class="sd">``True``).</span>

<span class="sd">Examples</span>
<span class="sd">~~~~~~~~</span>

<span class="sd">In order to write a **multi-frame PDB trajectory** from a universe *u* one can</span>
<span class="sd">do the following::</span>

<span class="sd">  pdb = MDAnalysis.Writer(&quot;all.pdb&quot;, multiframe=True)</span>
<span class="sd">  for ts in u.trajectory:</span>
<span class="sd">      pdb.write(u)</span>
<span class="sd">  pdb.close()</span>

<span class="sd">Similarly, writing only a protein::</span>

<span class="sd">  pdb = MDAnalysis.Writer(&quot;protein.pdb&quot;, multiframe=True)</span>
<span class="sd">  protein = u.select_atoms(&quot;protein&quot;)</span>
<span class="sd">  for ts in u.trajectory:</span>
<span class="sd">      pdb.write(protein)</span>
<span class="sd">  pdb.close()</span>

<span class="sd">A single frame can be written with the</span>
<span class="sd">:meth:`~MDAnalysis.core.AtomGroup.AtomGroup.write` method of any</span>
<span class="sd">:class:`~MDAnalysis.core.AtomGroup.AtomGroup`::</span>

<span class="sd">   protein = u.select_atoms(&quot;protein&quot;)</span>
<span class="sd">   protein.write(&quot;protein.pdb&quot;)</span>

<span class="sd">Alternatively, get the single frame writer and supply the</span>
<span class="sd">:class:`~MDAnalysis.core.AtomGroup.AtomGroup`::</span>

<span class="sd">  pdb = MDAnalysis.Writer(&quot;protein.pdb&quot;)</span>
<span class="sd">  protein = u.select_atoms(&quot;protein&quot;)</span>
<span class="sd">  pdb.write(protein)</span>
<span class="sd">  pdb.close()</span>


<span class="sd">Classes</span>
<span class="sd">~~~~~~~</span>

<span class="sd">.. autoclass:: PDBReader</span>
<span class="sd">   :members:</span>

<span class="sd">.. autoclass:: PDBWriter</span>
<span class="sd">   :members:</span>

<span class="sd">   .. automethod:: _check_pdb_coordinates</span>
<span class="sd">   .. automethod:: _write_pdb_bonds</span>
<span class="sd">   .. automethod:: _update_frame</span>
<span class="sd">   .. automethod:: _write_timestep</span>

<span class="sd">.. autoclass:: MultiPDBWriter</span>
<span class="sd">   :members:</span>


<span class="sd">..deprecated:: 0.15.0</span>
<span class="sd">    The &quot;permissive&quot; flag is not used anymore (and effectively defaults to True);</span>
<span class="sd">    it will be completely removed in 0.16.0.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">..core</span> <span class="kn">import</span> <span class="n">flags</span>
<span class="kn">from</span> <span class="nn">..lib</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">base</span>
<span class="kn">from</span> <span class="nn">..topology.core</span> <span class="kn">import</span> <span class="n">guess_atom_element</span>
<span class="kn">from</span> <span class="nn">..core.AtomGroup</span> <span class="kn">import</span> <span class="n">Universe</span>
<span class="kn">from</span> <span class="nn">..exceptions</span> <span class="kn">import</span> <span class="n">NoDataError</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;MDAnalysis.coordinates.PBD&quot;</span><span class="p">)</span>

<span class="c1"># Pairs of residue name / atom name in use to deduce PDB formatted atom names</span>
<span class="n">Pair</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Atom&#39;</span><span class="p">,</span> <span class="s1">&#39;resname name&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="PDBReader"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBReader">[docs]</a><span class="k">class</span> <span class="nc">PDBReader</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Reader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PDBReader that reads a `PDB-formatted`_ file, no frills.</span>

<span class="sd">    The following *PDB records* are parsed (see `PDB coordinate section`_ for</span>
<span class="sd">    details):</span>

<span class="sd">     - *CRYST1* for unitcell A,B,C, alpha,beta,gamma</span>
<span class="sd">     - *ATOM* or *HETATM* for serial,name,resName,chainID,resSeq,x,y,z,occupancy,tempFactor</span>
<span class="sd">     - *HEADER* (:attr:`header`), *TITLE* (:attr:`title`), *COMPND*</span>
<span class="sd">       (:attr:`compound`), *REMARK* (:attr:`remarks`)</span>
<span class="sd">     - all other lines are ignored</span>

<span class="sd">    Reads multi-`MODEL`_ PDB files as trajectories.</span>

<span class="sd">    .. _PDB-formatted:</span>
<span class="sd">       http://www.wwpdb.org/documentation/file-format-content/format33/v3.3.html</span>
<span class="sd">    .. _PDB coordinate section:</span>
<span class="sd">       http://www.wwpdb.org/documentation/format32/sect9.html</span>
<span class="sd">    .. _MODEL:</span>
<span class="sd">       http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>

<span class="sd">    =============  ============  ===========  =============================================</span>
<span class="sd">    COLUMNS        DATA  TYPE    FIELD        DEFINITION</span>
<span class="sd">    =============  ============  ===========  =============================================</span>
<span class="sd">    1 -  6         Record name   &quot;CRYST1&quot;</span>
<span class="sd">    7 - 15         Real(9.3)     a              a (Angstroms).</span>
<span class="sd">    16 - 24        Real(9.3)     b              b (Angstroms).</span>
<span class="sd">    25 - 33        Real(9.3)     c              c (Angstroms).</span>
<span class="sd">    34 - 40        Real(7.2)     alpha          alpha (degrees).</span>
<span class="sd">    41 - 47        Real(7.2)     beta           beta (degrees).</span>
<span class="sd">    48 - 54        Real(7.2)     gamma          gamma (degrees).</span>

<span class="sd">    1 -  6         Record name   &quot;ATOM  &quot;</span>
<span class="sd">    7 - 11         Integer       serial       Atom  serial number.</span>
<span class="sd">    13 - 16        Atom          name         Atom name.</span>
<span class="sd">    17             Character     altLoc       Alternate location indicator. IGNORED</span>
<span class="sd">    18 - 21        Residue name  resName      Residue name.</span>
<span class="sd">    22             Character     chainID      Chain identifier.</span>
<span class="sd">    23 - 26        Integer       resSeq       Residue sequence number.</span>
<span class="sd">    27             AChar         iCode        Code for insertion of residues. IGNORED</span>
<span class="sd">    31 - 38        Real(8.3)     x            Orthogonal coordinates for X in Angstroms.</span>
<span class="sd">    39 - 46        Real(8.3)     y            Orthogonal coordinates for Y in Angstroms.</span>
<span class="sd">    47 - 54        Real(8.3)     z            Orthogonal coordinates for Z in Angstroms.</span>
<span class="sd">    55 - 60        Real(6.2)     occupancy    Occupancy.</span>
<span class="sd">    61 - 66        Real(6.2)     tempFactor   Temperature  factor.</span>
<span class="sd">    67 - 76        String        segID        (unofficial CHARMM extension ?)</span>
<span class="sd">    77 - 78        LString(2)    element      Element symbol, right-justified. IGNORED</span>
<span class="sd">    79 - 80        LString(2)    charge       Charge  on the atom. IGNORED</span>
<span class="sd">    =============  ============  ===========  =============================================</span>


<span class="sd">    .. SeeAlso:: :class:`PDBWriter`; :class:`PDBReader`</span>
<span class="sd">                 implements a larger subset of the header records,</span>
<span class="sd">                 which are accessible as :attr:`PDBReader.metadata`.</span>

<span class="sd">    .. versionchanged:: 0.11.0</span>
<span class="sd">       * Frames now 0-based instead of 1-based</span>
<span class="sd">       * New :attr:`title` (list with all TITLE lines).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;PDB&#39;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read coordinates from *filename*.</span>

<span class="sd">        *filename* can be a gzipped or bzip2ed compressed PDB file.</span>

<span class="sd">        If the pdb file contains multiple MODEL records then it is</span>
<span class="sd">        read as a trajectory where the MODEL numbers correspond to</span>
<span class="sd">        frame numbers. Therefore, the MODEL numbers must be a sequence</span>
<span class="sd">        of integers (typically starting at 1 or 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PDBReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_atoms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PDBReader requires the n_atoms keyword&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model_offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">compound</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remarks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">frames</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Timestep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_atoms</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts_kwargs</span><span class="p">)</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># atom position for filling coordinates array</span>
        <span class="n">occupancy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_atoms</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">openany</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdbfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove extra spaces</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Skip line if empty</span>
                    <span class="k">continue</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">record</span> <span class="o">==</span> <span class="s1">&#39;END&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s1">&#39;CRYST1&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">15</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">24</span><span class="p">],</span>
                                            <span class="n">line</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">33</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">40</span><span class="p">],</span>
                                            <span class="n">line</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">47</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">47</span><span class="p">:</span><span class="mi">54</span><span class="p">]]</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s1">&#39;HEADER&#39;</span><span class="p">:</span>
                    <span class="c1"># classification = line[10:50]</span>
                    <span class="c1"># date = line[50:59]</span>
                    <span class="c1"># idCode = line[62:66]</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">80</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s1">&#39;COMPND&#39;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">80</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">compound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s1">&#39;REMARK&#39;</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">remarks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s1">&#39;MODEL&#39;</span><span class="p">:</span>
                    <span class="n">frames</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>  <span class="c1"># 0-based indexing</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ATOM  &#39;</span><span class="p">,</span> <span class="s1">&#39;HETATM&#39;</span><span class="p">):</span>
                    <span class="c1"># skip atom/hetatm for frames other than the first</span>
                    <span class="c1"># they will be read in when next() is called</span>
                    <span class="c1"># on the trajectory reader</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">38</span><span class="p">],</span>
                                         <span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">46</span><span class="p">],</span>
                                         <span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">54</span><span class="p">]]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">occupancy</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">54</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compound</span> <span class="o">=</span> <span class="n">compound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span> <span class="o">=</span> <span class="n">remarks</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_atoms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Read an incorrect number of atoms</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="s2">&quot;Expected {expected} got {actual}&quot;</span>
                             <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_atoms</span><span class="p">,</span> <span class="n">actual</span><span class="o">=</span><span class="n">pos</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pos</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 0-based frame number as starting frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;occupancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occupancy</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">)</span>  <span class="c1"># in-place !</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># in-place ! (only lengths)</span>

        <span class="c1"># No &#39;MODEL&#39; entries</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">frames</span><span class="p">:</span>
            <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="k">if</span> <span class="n">frames</span> <span class="k">else</span> <span class="mi">1</span>

<div class="viewcode-block" id="PDBReader.Writer"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBReader.Writer">[docs]</a>    <span class="k">def</span> <span class="nf">Writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a PDBWriter for *filename*.</span>

<span class="sd">        :Arguments:</span>
<span class="sd">          *filename*</span>
<span class="sd">              filename of the output PDB file</span>

<span class="sd">        :Returns: :class:`PDBWriter`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;multiframe&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_frames</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PDBWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">rewind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_frame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reopen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Pretend the current TS is -1 (in 0 based) so &quot;next&quot; is the</span>
        <span class="c1"># 0th frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_read_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO: cleanup _read_frame() to use a &quot;free&quot; Timestep</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;PDBReader cannot assign to a timestep&quot;</span><span class="p">)</span>
        <span class="c1"># frame is 1-based. Normally would add 1 to frame before calling</span>
        <span class="c1"># self._read_frame to retrieve the subsequent ts. But self._read_frame</span>
        <span class="c1"># assumes it is being passed a 0-based frame, and adjusts.</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># single frame file, we already have the timestep</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>

        <span class="c1"># TODO: only open file once and leave the file open; then seek back and</span>
        <span class="c1">#       forth; should improve performance substantially</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">occupancy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_atoms</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">openany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># forward to frame</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ENDMDL&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="c1"># NOTE - CRYST1 line won&#39;t be found if it comes before the</span>
                <span class="c1"># MODEL line, which is sometimes the case, e.g. output from</span>
                <span class="c1"># gromacs trjconv</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CRYST1&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">15</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">24</span><span class="p">],</span>
                                            <span class="n">line</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">33</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">40</span><span class="p">],</span>
                                            <span class="n">line</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">47</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">47</span><span class="p">:</span><span class="mi">54</span><span class="p">]]</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ATOM  &#39;</span><span class="p">,</span> <span class="s1">&#39;HETATM&#39;</span><span class="p">):</span>
                    <span class="c1"># we only care about coordinates</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">38</span><span class="p">],</span>
                                         <span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">46</span><span class="p">],</span>
                                         <span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">54</span><span class="p">]]</span>
                    <span class="c1"># TODO import bfactors - might these change?</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">occupancy</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">54</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># Be tolerant for ill-formated or empty occupancies</span>
                        <span class="k">pass</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

        <span class="c1"># check if atom number changed</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_atoms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Read an incorrect number of atoms</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="s2">&quot;Expected {expected} got {actual}&quot;</span>
                             <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_atoms</span><span class="p">,</span> <span class="n">actual</span><span class="o">=</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="c1"># both happen inplace</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;occupancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occupancy</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span></div>


<div class="viewcode-block" id="PDBWriter"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter">[docs]</a><span class="k">class</span> <span class="nc">PDBWriter</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Writer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PDB writer that implements a subset of the `PDB 3.2 standard`_ .</span>

<span class="sd">    PDB format as used by NAMD/CHARMM: 4-letter resnames and segID are allowed,</span>
<span class="sd">    altLoc is written.</span>

<span class="sd">    The :class:`PDBWriter` can be used to either dump a coordinate</span>
<span class="sd">    set to a PDB file (operating as a &quot;single frame writer&quot;, selected with the</span>
<span class="sd">    constructor keyword *multiframe* = ``False``, the default) or by writing a</span>
<span class="sd">    PDB &quot;movie&quot; (multi frame mode, *multiframe* = ``True``), consisting of</span>
<span class="sd">    multiple models (using the MODEL_ and ENDMDL_ records).</span>

<span class="sd">    .. _`PDB 3.2 standard`:</span>
<span class="sd">       http://www.wwpdb.org/documentation/format32/v3.2.html</span>
<span class="sd">    .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>
<span class="sd">    .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>
<span class="sd">    .. _CONECT: http://www.wwpdb.org/documentation/format32/sect10.html#CONECT</span>

<span class="sd">    .. SeeAlso::</span>
<span class="sd">       This class is identical to :class:`MultiPDBWriter` with the one</span>
<span class="sd">       exception that it defaults to writing single-frame PDB files as if</span>
<span class="sd">       *multiframe* = ``False`` was selected.</span>

<span class="sd">    .. versionchanged:: 0.7.5</span>
<span class="sd">       Initial support for multi-frame PDB files.</span>

<span class="sd">    .. versionchanged:: 0.7.6</span>
<span class="sd">       The *multiframe* keyword was added to select the writing mode. The</span>
<span class="sd">       writing of bond information (CONECT_ records) is now disabled by default</span>
<span class="sd">       but can be enabled with the *bonds* keyword.</span>

<span class="sd">    .. versionchanged:: 0.11.0</span>
<span class="sd">       Frames now 0-based instead of 1-based</span>

<span class="sd">    .. versionchanged:: 0.14.0</span>
<span class="sd">       PDB doesn&#39;t save charge information</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ATOM&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;ATOM  {serial:5d} {name:&lt;4s}{altLoc:&lt;1s}{resName:&lt;4s}&quot;</span>
            <span class="s2">&quot;{chainID:1s}{resSeq:4d}{iCode:1s}&quot;</span>
            <span class="s2">&quot;   {pos[0]:8.3f}{pos[1]:8.3f}{pos[2]:8.3f}{occupancy:6.2f}&quot;</span>
            <span class="s2">&quot;{tempFactor:6.2f}      {segID:&lt;4s}{element:&gt;2s}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="s1">&#39;REMARK&#39;</span><span class="p">:</span> <span class="s2">&quot;REMARK     {0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;COMPND&#39;</span><span class="p">:</span> <span class="s2">&quot;COMPND    {0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;HEADER&#39;</span><span class="p">:</span> <span class="s2">&quot;HEADER    {0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;TITLE&#39;</span><span class="p">:</span> <span class="s2">&quot;TITLE     {0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;MODEL&#39;</span><span class="p">:</span> <span class="s2">&quot;MODEL     {0:5d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;NUMMDL&#39;</span><span class="p">:</span> <span class="s2">&quot;NUMMDL    {0:5d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;ENDMDL&#39;</span><span class="p">:</span> <span class="s2">&quot;ENDMDL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;END&#39;</span><span class="p">:</span> <span class="s2">&quot;END</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;CRYST1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;CRYST1{box[0]:9.3f}{box[1]:9.3f}{box[2]:9.3f}&quot;</span>
                   <span class="s2">&quot;{ang[0]:7.2f}{ang[1]:7.2f}{ang[2]:7.2f} &quot;</span>
                   <span class="s2">&quot;{spacegroup:&lt;11s}{zvalue:4d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="s1">&#39;CONECT&#39;</span><span class="p">:</span> <span class="s2">&quot;CONECT{0}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">}</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;PDB&#39;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">}</span>
    <span class="n">pdb_coor_limits</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">999.9995</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">9999.9995</span><span class="p">}</span>
    <span class="c1">#: wrap comments into REMARK records that are not longer than</span>
    <span class="c1"># :attr:`remark_max_length` characters.</span>
    <span class="n">remark_max_length</span> <span class="o">=</span> <span class="mi">66</span>
    <span class="n">multiframe</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1"># These attributes are used to deduce how to format the atom name.</span>
    <span class="n">ions</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;FE&#39;</span><span class="p">,</span> <span class="s1">&#39;AS&#39;</span><span class="p">,</span> <span class="s1">&#39;ZN&#39;</span><span class="p">,</span> <span class="s1">&#39;MG&#39;</span><span class="p">,</span> <span class="s1">&#39;MN&#39;</span><span class="p">,</span> <span class="s1">&#39;CO&#39;</span><span class="p">,</span> <span class="s1">&#39;BR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CU&#39;</span><span class="p">,</span> <span class="s1">&#39;TA&#39;</span><span class="p">,</span> <span class="s1">&#39;MO&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">,</span> <span class="s1">&#39;BE&#39;</span><span class="p">,</span> <span class="s1">&#39;SE&#39;</span><span class="p">,</span> <span class="s1">&#39;PT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EU&#39;</span><span class="p">,</span> <span class="s1">&#39;NI&#39;</span><span class="p">,</span> <span class="s1">&#39;IR&#39;</span><span class="p">,</span> <span class="s1">&#39;RH&#39;</span><span class="p">,</span> <span class="s1">&#39;AU&#39;</span><span class="p">,</span> <span class="s1">&#39;GD&#39;</span><span class="p">,</span> <span class="s1">&#39;RU&#39;</span><span class="p">)</span>
    <span class="c1"># Mercurial can be confused for hydrogen gamma. Yet, mercurial is</span>
    <span class="c1"># rather rare in the PDB. Here are all the residues that contain</span>
    <span class="c1"># mercurial.</span>
    <span class="n">special_hg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;CMH&#39;</span><span class="p">,</span> <span class="s1">&#39;EMC&#39;</span><span class="p">,</span> <span class="s1">&#39;MBO&#39;</span><span class="p">,</span> <span class="s1">&#39;MMC&#39;</span><span class="p">,</span> <span class="s1">&#39;HGB&#39;</span><span class="p">,</span> <span class="s1">&#39;BE7&#39;</span><span class="p">,</span> <span class="s1">&#39;PMB&#39;</span><span class="p">)</span>
    <span class="c1"># Chloride can be confused for a carbon. Here are the residues that</span>
    <span class="c1"># contain chloride.</span>
    <span class="n">special_cl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;0QE&#39;</span><span class="p">,</span> <span class="s1">&#39;CPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DCE&#39;</span><span class="p">,</span> <span class="s1">&#39;EAA&#39;</span><span class="p">,</span> <span class="s1">&#39;IMN&#39;</span><span class="p">,</span> <span class="s1">&#39;OCZ&#39;</span><span class="p">,</span> <span class="s1">&#39;OMY&#39;</span><span class="p">,</span> <span class="s1">&#39;OMZ&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;UN9&#39;</span><span class="p">,</span> <span class="s1">&#39;1N1&#39;</span><span class="p">,</span> <span class="s1">&#39;2T8&#39;</span><span class="p">,</span> <span class="s1">&#39;393&#39;</span><span class="p">,</span> <span class="s1">&#39;3MY&#39;</span><span class="p">,</span> <span class="s1">&#39;BMU&#39;</span><span class="p">,</span> <span class="s1">&#39;CLM&#39;</span><span class="p">,</span> <span class="s1">&#39;CP6&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;DB8&#39;</span><span class="p">,</span> <span class="s1">&#39;DIF&#39;</span><span class="p">,</span> <span class="s1">&#39;EFZ&#39;</span><span class="p">,</span> <span class="s1">&#39;LUR&#39;</span><span class="p">,</span> <span class="s1">&#39;RDC&#39;</span><span class="p">,</span> <span class="s1">&#39;UCL&#39;</span><span class="p">,</span> <span class="s1">&#39;XMM&#39;</span><span class="p">,</span> <span class="s1">&#39;HLT&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;IRE&#39;</span><span class="p">,</span> <span class="s1">&#39;LCP&#39;</span><span class="p">,</span> <span class="s1">&#39;PCI&#39;</span><span class="p">,</span> <span class="s1">&#39;VGH&#39;</span><span class="p">)</span>
    <span class="c1"># In these pairs, the atom name is aligned on the first column</span>
    <span class="c1"># (column 13).</span>
    <span class="n">include_pairs</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;OEC&#39;</span><span class="p">,</span> <span class="s1">&#39;CA1&#39;</span><span class="p">),</span>
                     <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;PLL&#39;</span><span class="p">,</span> <span class="s1">&#39;PD&#39;</span><span class="p">),</span>
                     <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;OEX&#39;</span><span class="p">,</span> <span class="s1">&#39;CA1&#39;</span><span class="p">))</span>
    <span class="c1"># In these pairs, the atom name is aligned on the second column</span>
    <span class="c1"># (column 14), but other rules would align them on the first column.</span>
    <span class="n">exclude_pairs</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;C14&#39;</span><span class="p">,</span> <span class="s1">&#39;C14&#39;</span><span class="p">),</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;C15&#39;</span><span class="p">,</span> <span class="s1">&#39;C15&#39;</span><span class="p">),</span>
                     <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;F9F&#39;</span><span class="p">,</span> <span class="s1">&#39;F9F&#39;</span><span class="p">),</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;OAN&#39;</span><span class="p">,</span> <span class="s1">&#39;OAN&#39;</span><span class="p">),</span>
                     <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;BLM&#39;</span><span class="p">,</span> <span class="s1">&#39;NI&#39;</span><span class="p">),</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;BZG&#39;</span><span class="p">,</span> <span class="s1">&#39;CO&#39;</span><span class="p">),</span>
                     <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;BZG&#39;</span><span class="p">,</span> <span class="s1">&#39;NI&#39;</span><span class="p">),</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;VNL&#39;</span><span class="p">,</span> <span class="s1">&#39;CO1&#39;</span><span class="p">),</span>
                     <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;VNL&#39;</span><span class="p">,</span> <span class="s1">&#39;CO2&#39;</span><span class="p">),</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;PF5&#39;</span><span class="p">,</span> <span class="s1">&#39;FE1&#39;</span><span class="p">),</span>
                     <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;PF5&#39;</span><span class="p">,</span> <span class="s1">&#39;FE2&#39;</span><span class="p">),</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;UNL&#39;</span><span class="p">,</span> <span class="s1">&#39;UNL&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">bonds</span><span class="o">=</span><span class="s2">&quot;conect&quot;</span><span class="p">,</span> <span class="n">n_atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">remarks</span><span class="o">=</span><span class="s2">&quot;Created by PDBWriter&quot;</span><span class="p">,</span>
                 <span class="n">convert_units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">multiframe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new PDBWriter</span>

<span class="sd">        :Arguments:</span>
<span class="sd">         *filename*</span>
<span class="sd">           name of output file</span>
<span class="sd">         *start*</span>
<span class="sd">           starting timestep</span>
<span class="sd">         *step*</span>
<span class="sd">           skip between subsequent timesteps</span>
<span class="sd">         *remarks*</span>
<span class="sd">           comments to annotate pdb file (added to the TITLE record); note that</span>
<span class="sd">           any remarks from the trajectory that serves as input are</span>
<span class="sd">           written to REMARK records with lines longer than :attr:`remark_max_length` (66</span>
<span class="sd">           characters) being wrapped.</span>
<span class="sd">         *convert_units*</span>
<span class="sd">           units are converted to the MDAnalysis base format; ``None`` selects</span>
<span class="sd">           the value of :data:`MDAnalysis.core.flags` [&#39;convert_lengths&#39;]</span>
<span class="sd">         *bonds*</span>
<span class="sd">           write bonds to the PDB file as CONECT_ records [``False``]</span>

<span class="sd">           .. Note::</span>

<span class="sd">              Currently only works when writing a whole :class:`Universe` and</span>
<span class="sd">              if bond information is available in the topology. (For selections</span>
<span class="sd">              smaller than the whole :class:`Universe`, the atom numbering in</span>
<span class="sd">              the CONECT_ records would not match the numbering of the atoms in</span>
<span class="sd">              the new PDB file and therefore a :exc:`NotImplementedError` is</span>
<span class="sd">              raised.)</span>

<span class="sd">         *multiframe*</span>
<span class="sd">           ``False``: write a single frame to the file; ``True``: create a</span>
<span class="sd">           multi frame PDB file in which frames are written as MODEL_ ... ENDMDL_</span>
<span class="sd">           records. If ``None``, then the class default is chosen.    [``None``]</span>

<span class="sd">        .. _CONECT: http://www.wwpdb.org/documentation/format32/sect10.html#CONECT</span>
<span class="sd">        .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>
<span class="sd">        .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># n_atoms = None : dummy keyword argument</span>
        <span class="c1"># (not used, but Writer() always provides n_atoms as the second argument)</span>

        <span class="c1"># TODO: - remarks should be a list of lines and written to REMARK</span>
        <span class="c1">#       - additional title keyword could contain line for TITLE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">convert_units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">convert_units</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[</span><span class="s1">&#39;convert_lengths&#39;</span><span class="p">]</span>
        <span class="c1"># convert length and time to base units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span> <span class="o">=</span> <span class="n">convert_units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multiframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiframe</span> <span class="k">if</span> <span class="n">multiframe</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">multiframe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="n">bonds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frames_written</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;Start&#39; must be a positive value&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span> <span class="o">=</span> <span class="n">remarks</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">anyopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span>  <span class="c1"># open file on init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_END</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_frame_done</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="PDBWriter.close"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close PDB file and write END record&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdbfile&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_END</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">END</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;END record has already been written&quot;</span>
                            <span class="s2">&quot; before the final closing of the file&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span> <span class="o">=</span> <span class="bp">None</span></div>

    <span class="k">def</span> <span class="nf">_write_pdb_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiframe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TITLE</span><span class="p">(</span><span class="s2">&quot;MDANALYSIS FRAMES FROM {0:d}, SKIP {1:d}: {2!s}&quot;</span>
                       <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TITLE</span><span class="p">(</span><span class="s2">&quot;MDANALYSIS FRAME {0:d}: {1!s}&quot;</span>
                       <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_write_pdb_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;universe&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_title</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_frame_done</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">first_frame_done</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">universe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HEADER</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_title</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">COMPND</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># currently inconsistent: DCDReader gives a string,</span>
            <span class="c1"># PDB*Reader a list, so always get a list</span>
            <span class="c1"># split long single lines into chunks of 66 chars</span>
            <span class="n">remarks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">util</span><span class="o">.</span><span class="n">asiterable</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">remarks</span><span class="p">):</span>
                <span class="n">remarks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remark_max_length</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">REMARK</span><span class="p">(</span><span class="o">*</span><span class="n">remarks</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CRYST1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_dimensions_to_unitcell</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span><span class="p">))</span>

<div class="viewcode-block" id="PDBWriter._check_pdb_coordinates"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter._check_pdb_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">_check_pdb_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the coordinate values fall within the range allowed for PDB files.</span>

<span class="sd">        Deletes the output file if this is the first frame or if frames have</span>
<span class="sd">        already been written (in multi-frame mode) adds a REMARK instead of the</span>
<span class="sd">        coordinates and closes the file.</span>

<span class="sd">        Raises :exc:`ValueError` if the coordinates fail the check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span>  <span class="c1"># make sure to use atoms (Issue 46)</span>
        <span class="c1"># can write from selection == Universe (Issue 49)</span>
        <span class="n">coor</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span>

        <span class="c1"># check if any coordinates are illegal (coordinates are already in</span>
        <span class="c1"># Angstroem per package default)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_coor_limits</span><span class="p">,</span> <span class="n">coor</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="c1"># note the precarious close() here: we know that the file is open and</span>
        <span class="c1"># we now prepare to remove what we have already written (header and</span>
        <span class="c1"># such) or add a REMARK (which allows the user to look at the</span>
        <span class="c1"># previously written frames)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames_written</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">REMARK</span><span class="p">(</span><span class="s2">&quot;Incomplete multi-frame trajectory.&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Coordinates for the current frame cannot be &quot;</span>
                        <span class="s2">&quot;represented in the PDB format.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PDB files must have coordinate values between &quot;</span>
                         <span class="s2">&quot;{0:.3f} and {1:.3f} Angstroem: file writing was &quot;</span>
                         <span class="s2">&quot;aborted.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_coor_limits</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">pdb_coor_limits</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="PDBWriter._write_pdb_bonds"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter._write_pdb_bonds">[docs]</a>    <span class="k">def</span> <span class="nf">_write_pdb_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes out all the bond records; works only for Universe objects.</span>

<span class="sd">        .. Warning::</span>

<span class="sd">           All bonds are written out, using the old atom numbers - this is</span>
<span class="sd">           incorrect. Once a selection is made, the atom numbers have to be</span>
<span class="sd">           updated (currently they are unmodified) and bonds have to be</span>
<span class="sd">           selected for, only if all the atoms for a bond are still present.</span>

<span class="sd">           Therefore, this method raises a :exc:`NotImplementedError` if CONECT</span>
<span class="sd">           records for anything smaller than the :class:`Universe` are written.</span>

<span class="sd">        .. versionchanged:: 0.7.6</span>
<span class="sd">           Only write CONECT records if :attr:`PDBWriter.bonds` ``== True``.</span>
<span class="sd">           Raises :exc:`NotImplementedError` if it would produce wrong output.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;universe&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">universe</span><span class="p">,</span> <span class="s1">&#39;bonds&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1">#logger.error(&quot;PDB CONECT records not written because this only works correctly for a whole Universe.&quot;)</span>
            <span class="c1">#raise NotImplementedError(&quot;PDB CONECT records not written because this only works correctly for a whole</span>
            <span class="c1"># Universe.&quot;)</span>

        <span class="n">bonds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="p">[[</span><span class="n">bonds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">bonds</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="p">}</span>

        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">atom</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="p">)}</span>

        <span class="c1"># Write out only the bonds that were defined in CONECT records</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">==</span> <span class="s2">&quot;conect&quot;</span><span class="p">:</span>
            <span class="n">bonds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bonds</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bond</span><span class="o">.</span><span class="n">is_guessed</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">bonds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bonds has to be either None, &#39;conect&#39; or &#39;all&#39;&quot;</span><span class="p">)</span>
        <span class="n">con</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a1</span> <span class="ow">in</span> <span class="n">atoms</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">con</span><span class="p">:</span>
                <span class="n">con</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">con</span><span class="p">:</span>
                <span class="n">con</span><span class="p">[</span><span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">con</span><span class="p">[</span><span class="n">a2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
            <span class="n">con</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>

        <span class="n">conect</span> <span class="o">=</span> <span class="p">[([</span><span class="n">a</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">con</span><span class="p">[</span><span class="n">a</span><span class="p">]))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atoms</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">con</span><span class="p">]</span>

        <span class="n">conect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">mapping</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">conect</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CONECT</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></div>

<div class="viewcode-block" id="PDBWriter._update_frame"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter._update_frame">[docs]</a>    <span class="k">def</span> <span class="nf">_update_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to initialize important attributes in writer from a AtomGroup or Universe *obj*.</span>

<span class="sd">        Attributes initialized/updated:</span>

<span class="sd">        * :attr:`PDBWriter.obj` (the entity that provides topology information *and*</span>
<span class="sd">          coordinates, either a :class:`~MDAnalysis.core.AtomGroup.AtomGroup` or a whole</span>
<span class="sd">          :class:`~MDAnalysis.core.AtomGroup.Universe`)</span>
<span class="sd">        * :attr:`PDBWriter.trajectory` (the underlying trajectory</span>
<span class="sd">          :class:`~MDAnalysis.coordinates.base.Reader`)</span>
<span class="sd">        * :attr:`PDBWriter.timestep` (the underlying trajectory</span>
<span class="sd">          :class:`~MDAnalysis.coordinates.base.Timestep`)</span>

<span class="sd">        Before calling :meth:`write_next_timestep` this method **must** be</span>
<span class="sd">        called at least once to enable extracting topology information from the</span>
<span class="sd">        current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">Timestep</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;PDBWriter cannot write Timestep objects &quot;</span>
                            <span class="s2">&quot;directly, since they lack topology information (&quot;</span>
                            <span class="s2">&quot;atom names and types) required in PDB files&quot;</span><span class="p">)</span>
        <span class="c1"># remember obj for some of other methods --- NOTE: this is an evil/lazy</span>
        <span class="c1"># hack...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">ts</span><span class="p">,</span> <span class="n">traj</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;universe&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Universe</span><span class="p">):</span>
            <span class="c1"># For AtomGroup and children (Residue, ResidueGroup, Segment)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span>
            <span class="n">traj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For Universe only</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span>
            <span class="n">traj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">trajectory</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ts</span> <span class="ow">and</span> <span class="n">traj</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;PDBWriter couldn&#39;t extract &quot;</span>
                                 <span class="s2">&quot;trajectory and timestep information &quot;</span>
                                 <span class="s2">&quot;from an object; inheritance problem.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="n">traj</span>  <span class="c1"># update trajectory (used by other methods)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>  <span class="c1"># update timestep (used by other methods)</span>
        <span class="k">return</span> <span class="n">traj</span><span class="p">,</span> <span class="n">ts</span></div>

<div class="viewcode-block" id="PDBWriter.write"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write object *obj* at current trajectory frame to file.</span>

<span class="sd">        *obj* can be a selection (i.e. a</span>
<span class="sd">        :class:`~MDAnalysis.core.AtomGroup.AtomGroup`) or a whole</span>
<span class="sd">        :class:`~MDAnalysis.core.AtomGroup.Universe`.</span>

<span class="sd">        The last letter of the :attr:`~MDAnalysis.core.AtomGroup.Atom.segid` is</span>
<span class="sd">        used as the PDB chainID (but see :meth:`~PDBWriter.ATOM` for</span>
<span class="sd">        details).</span>

<span class="sd">        :Arguments:</span>
<span class="sd">          *obj*</span>
<span class="sd">            :class:`~MDAnalysis.core.AtomGroup.AtomGroup` or</span>
<span class="sd">            :class:`~MDAnalysis.core.AtomGroup.Universe`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_frame</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_header</span><span class="p">()</span>
        <span class="c1"># Issue 105: with write() ONLY write a single frame; use</span>
        <span class="c1"># write_all_timesteps() to dump everything in one go, or do the</span>
        <span class="c1"># traditional loop over frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">multiframe</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_multiframe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_bonds</span><span class="p">()</span></div>
        <span class="c1"># END record is written when file is being close()d</span>

<div class="viewcode-block" id="PDBWriter.write_all_timesteps"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.write_all_timesteps">[docs]</a>    <span class="k">def</span> <span class="nf">write_all_timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write all timesteps associated with *obj* to the PDB file.</span>

<span class="sd">        *obj* can be a :class:`~MDAnalysis.core.AtomGroup.AtomGroup`</span>
<span class="sd">        or a :class:`~MDAnalysis.core.AtomGroup.Universe`.</span>

<span class="sd">        The method writes the frames from the one specified as *start* until</span>
<span class="sd">        the end, using a step of *skip* (*start* and *skip* are set in the</span>
<span class="sd">        constructor). Thus, if *u* is a Universe then ::</span>

<span class="sd">           u.trajectory[-2]</span>
<span class="sd">           pdb = PDBWriter(&quot;out.pdb&quot;, u.atoms.n_atoms)</span>
<span class="sd">           pdb.write_all_timesteps(u)</span>

<span class="sd">        will write a PDB trajectory containing the last 2 frames and ::</span>

<span class="sd">           pdb = PDBWriter(&quot;out.pdb&quot;, u.atoms.n_atoms, start=12, skip=2)</span>
<span class="sd">           pdb.write_all_timesteps(u)</span>

<span class="sd">        will be writing frames 12, 14, 16, ...</span>

<span class="sd">        .. versionchanged:: 0.11.0</span>
<span class="sd">           Frames now 0-based instead of 1-based</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_frame</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_header</span><span class="p">()</span>

        <span class="n">start</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
        <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span>

        <span class="c1"># Start from trajectory[0]/frame 0, if there are more than 1 frame.</span>
        <span class="c1"># If there is only 1 frame, the traj.frames is not like a python list:</span>
        <span class="c1"># accessing trajectory[-1] raises key error.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">traj</span><span class="o">.</span><span class="n">n_frames</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">frame</span>

        <span class="k">for</span> <span class="n">framenumber</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">traj</span><span class="p">),</span> <span class="n">step</span><span class="p">):</span>
            <span class="n">traj</span><span class="p">[</span><span class="n">framenumber</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">multiframe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_bonds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Set the trajectory to the starting position</span>
        <span class="n">traj</span><span class="p">[</span><span class="n">start</span><span class="p">]</span></div>

<div class="viewcode-block" id="PDBWriter.write_next_timestep"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.write_next_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">write_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;write a new timestep to the PDB file</span>

<span class="sd">        :Keywords:</span>
<span class="sd">          *ts*</span>
<span class="sd">             :class:`base.Timestep` object containing coordinates to be written to trajectory file;</span>
<span class="sd">             if ``None`` then :attr:`PDBWriter.ts`` is tried.</span>
<span class="sd">          *multiframe*</span>
<span class="sd">             ``False``: write a single frame (default); ``True`` behave as a trajectory writer</span>

<span class="sd">        .. Note::</span>

<span class="sd">           Before using this method with another :class:`base.Timestep` in the *ts*</span>
<span class="sd">           argument, :meth:`PDBWriter._update_frame` *must* be called</span>
<span class="sd">           with the :class:`~MDAnalysis.core.AtomGroup.AtomGroup.Universe` as</span>
<span class="sd">           its argument so that topology information can be gathered.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;ts&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">NoDataError</span><span class="p">(</span><span class="s2">&quot;PBDWriter: no coordinate data to write to &quot;</span>
                                  <span class="s2">&quot;trajectory file&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pdb_coordinates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_timestep</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_deduce_PDB_atom_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deduce how the atom name should be aligned.</span>

<span class="sd">        Atom name format can be deduced from the atom type, yet atom type is</span>
<span class="sd">        not always available. This function uses the atom name and residue name</span>
<span class="sd">        to deduce how the atom name should be formatted. The rules in use got</span>
<span class="sd">        inferred from an analysis of the PDB. See gist at</span>
<span class="sd">        &lt;https://gist.github.com/jbarnoud/37a524330f29b5b7b096&gt; for more</span>
<span class="sd">        details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39; {}  &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">atom</span><span class="o">.</span><span class="n">resname</span> <span class="o">==</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span>
               <span class="ow">or</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span>
               <span class="ow">or</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;UNK&#39;</span>
               <span class="ow">or</span> <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">resname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_hg</span> <span class="ow">and</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;HG&#39;</span><span class="p">)</span>
               <span class="ow">or</span> <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">resname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_cl</span> <span class="ow">and</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CL&#39;</span><span class="p">)</span>
               <span class="ow">or</span> <span class="n">Pair</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">resname</span><span class="p">,</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_pairs</span><span class="p">)</span>
              <span class="ow">and</span> <span class="n">Pair</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">resname</span><span class="p">,</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_pairs</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;{:&lt;4}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39; {:&lt;3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="PDBWriter._write_timestep"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter._write_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">_write_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">multiframe</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write a new timestep *ts* to file</span>

<span class="sd">        Does unit conversion if necessary.</span>

<span class="sd">        By setting *multiframe* = ``True``, MODEL_ ... ENDMDL_ records are</span>
<span class="sd">        written to represent trajectory frames in a multi-model PDB file. (At</span>
<span class="sd">        the moment we do *not* write the NUMMDL_ record.)</span>

<span class="sd">        The *multiframe* = ``False`` keyword signals that the</span>
<span class="sd">        :class:`PDBWriter` is in single frame mode and no MODEL_</span>
<span class="sd">        records are written.</span>

<span class="sd">        .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>
<span class="sd">        .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>
<span class="sd">        .. _NUMMDL: http://www.wwpdb.org/documentation/format32/sect2.html#NUMMDL</span>

<span class="sd">        .. versionchanged:: 0.7.6</span>
<span class="sd">           The *multiframe* keyword was added, which completely determines if</span>
<span class="sd">           MODEL records are written. (Previously, this was decided based on the</span>
<span class="sd">           underlying trajectory and only if ``len(traj) &gt; 1`` would MODEL records</span>
<span class="sd">           have been written.)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">positions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_to_native</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">multiframe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MODEL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames_written</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
            <span class="n">segid</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">segid</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">segid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s2">&quot;SYSTEM&quot;</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span>

            <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>  <span class="c1"># check for overflow here?</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deduce_PDB_atom_name</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;altLoc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">altLoc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">altLoc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;resName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">resname</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;chainID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segid</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;resSeq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">resid</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;iCode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># don&#39;t take off atom so conversion works</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">occ</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">occupancy</span>
            <span class="k">except</span> <span class="n">NoDataError</span><span class="p">:</span>
                <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;occupancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occ</span> <span class="k">if</span> <span class="n">occ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="mf">1.0</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">bfactor</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;tempFactor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span> <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;segID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segid</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;element&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">guess_atom_element</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">())[:</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># .. _ATOM: http://www.wwpdb.org/documentation/format32/sect9.html</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;ATOM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">vals</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">multiframe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ENDMDL</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames_written</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PDBWriter.HEADER"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.HEADER">[docs]</a>    <span class="k">def</span> <span class="nf">HEADER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write HEADER_ record.</span>

<span class="sd">        .. _HEADER: http://www.wwpdb.org/documentation/format32/sect2.html#HEADER</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;HEADER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">))</span></div>

<div class="viewcode-block" id="PDBWriter.TITLE"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.TITLE">[docs]</a>    <span class="k">def</span> <span class="nf">TITLE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write TITLE_ record.</span>

<span class="sd">        .. _TITLE: http://www.wwpdb.org/documentation/format32/sect2.html</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>  <span class="c1"># TODO: should do continuation automatically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">))</span></div>

<div class="viewcode-block" id="PDBWriter.REMARK"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.REMARK">[docs]</a>    <span class="k">def</span> <span class="nf">REMARK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">remarks</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write generic REMARK_ record (without number).</span>

<span class="sd">        Each string provided in *remarks* is written as a separate REMARK_</span>
<span class="sd">        record.</span>

<span class="sd">        See also `REMARK (update)`_.</span>

<span class="sd">        .. _REMARK: http://www.wwpdb.org/documentation/format32/remarks1.html</span>
<span class="sd">        .. _REMARK (update): http://www.wwpdb.org/documentation/format32/remarks2.html</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">remark</span> <span class="ow">in</span> <span class="n">remarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;REMARK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">remark</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">COMPND</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="s1">&#39;compound&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">compound</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">compound</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">compound</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;COMPND&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<div class="viewcode-block" id="PDBWriter.CRYST1"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.CRYST1">[docs]</a>    <span class="k">def</span> <span class="nf">CRYST1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">spacegroup</span><span class="o">=</span><span class="s1">&#39;P 1&#39;</span><span class="p">,</span> <span class="n">zvalue</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write CRYST1_ record.</span>

<span class="sd">        .. _CRYST1: http://www.wwpdb.org/documentation/format32/sect8.html</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;CRYST1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">box</span><span class="o">=</span><span class="n">dimensions</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">ang</span><span class="o">=</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span>
            <span class="n">spacegroup</span><span class="o">=</span><span class="n">spacegroup</span><span class="p">,</span>
            <span class="n">zvalue</span><span class="o">=</span><span class="n">zvalue</span><span class="p">))</span></div>

<div class="viewcode-block" id="PDBWriter.MODEL"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.MODEL">[docs]</a>    <span class="k">def</span> <span class="nf">MODEL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelnumber</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the MODEL_ record.</span>

<span class="sd">        .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;MODEL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modelnumber</span><span class="p">))</span></div>

<div class="viewcode-block" id="PDBWriter.END"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.END">[docs]</a>    <span class="k">def</span> <span class="nf">END</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write END_ record.</span>

<span class="sd">        Only a single END record is written. Calling END multiple times has no</span>
<span class="sd">        effect. Because :meth:`~PDBWriter.close` also calls this</span>
<span class="sd">        method right before closing the file it is recommended to *not* call</span>
<span class="sd">        :meth:`~PDBWriter.END` explicitly.</span>

<span class="sd">        .. _END: http://www.wwpdb.org/documentation/format32/sect11.html#END</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_END</span><span class="p">:</span>
            <span class="c1"># only write a single END record</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;END&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_END</span> <span class="o">=</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="PDBWriter.ENDMDL"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.ENDMDL">[docs]</a>    <span class="k">def</span> <span class="nf">ENDMDL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the ENDMDL_ record.</span>

<span class="sd">        .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;ENDMDL&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="PDBWriter.CONECT"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.CONECT">[docs]</a>    <span class="k">def</span> <span class="nf">CONECT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conect</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write CONECT_ record.</span>

<span class="sd">        .. _CONECT: http://www.wwpdb.org/documentation/format32/sect10.html#CONECT</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conect</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;{0:5d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">conect</span><span class="p">]</span>
        <span class="n">conect</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;CONECT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conect</span><span class="p">))</span></div></div>


<span class="k">class</span> <span class="nc">PrimitivePDBReader</span><span class="p">(</span><span class="n">PDBReader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;PrimitivePDBReader is identical to the PDBReader,&#39;</span>
                  <span class="s1">&#39; it is deprecated in favor of the shorter name&#39;</span>
                  <span class="s1">&#39; removal targeted for version 0.16.0&#39;</span><span class="p">,</span>
                  <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PrimitivePDBReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PrimitivePDBWriter</span><span class="p">(</span><span class="n">PDBWriter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;PrimitivePDBWriter is identical to the Writer,&#39;</span>
                      <span class="s1">&#39;it is deprecated in favor of the shorter name&#39;</span>
                      <span class="s1">&#39; removal targeted for version 0.16.0&#39;</span><span class="p">,</span>
                      <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PrimitivePDBWriter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ExtendedPDBReader</span><span class="p">(</span><span class="n">PDBReader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PDBReader that reads a PDB-formatted file with five-digit residue numbers.</span>

<span class="sd">    This reader does not conform to the `PDB standard`_ because it allows</span>
<span class="sd">    five-digit residue numbers that may take up columns 23 to 27 (inclusive)</span>
<span class="sd">    instead of being confined to 23-26 (with column 27 being reserved for the</span>
<span class="sd">    insertion code in the PDB standard). PDB files in this format are written</span>
<span class="sd">    by popular programs such as VMD_.</span>

<span class="sd">    .. SeeAlso:: :class:`PDBReader`</span>

<span class="sd">    .. _PDB standard: http://www.wwpdb.org/documentation/format32/sect9.html</span>
<span class="sd">    .. _VMD: http://www.ks.uiuc.edu/Research/vmd/</span>

<span class="sd">    .. versionadded:: 0.8</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;XPDB&quot;</span>


<div class="viewcode-block" id="MultiPDBWriter"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.MultiPDBWriter">[docs]</a><span class="k">class</span> <span class="nc">MultiPDBWriter</span><span class="p">(</span><span class="n">PDBWriter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PDB writer that implements a subset of the `PDB 3.2 standard`_ .</span>

<span class="sd">    PDB format as used by NAMD/CHARMM: 4-letter resnames and segID, altLoc</span>
<span class="sd">    is written.</span>

<span class="sd">    By default, :class:`MultiPDBWriter` writes a PDB &quot;movie&quot; (multi frame mode,</span>
<span class="sd">    *multiframe* = ``True``), consisting of multiple models (using the MODEL_</span>
<span class="sd">    and ENDMDL_ records).</span>

<span class="sd">    .. _`PDB 3.2 standard`:</span>
<span class="sd">       http://www.wwpdb.org/documentation/format32/v3.2.html</span>

<span class="sd">    .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>
<span class="sd">    .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>
<span class="sd">    .. _CONECT: http://www.wwpdb.org/documentation/format32/sect10.html#CONECT</span>


<span class="sd">    .. SeeAlso::</span>
<span class="sd">       This class is identical to :class:`PDBWriter` with the one</span>
<span class="sd">       exception that it defaults to writing multi-frame PDB files instead of</span>
<span class="sd">       single frames.</span>

<span class="sd">    .. versionadded:: 0.7.6</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;PDB&#39;</span>
    <span class="n">multiframe</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># For Writer registration</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MDAnalysis 0.14.1-dev0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2005-2015, Naveen Michaud-Agrawal, Elizabeth J. Denning, Christian Beckstein (logo), Joshua L. Adelman, Balasubramanian, Jonathan Barnoud, Alejandro Bernardin, Sbastien Buchoux, David Caplan, Matthieu Chavent, John Detlefs, Xavier Deupi, Jan Domanski, David L. Dotson, Lennard van der Feltz, Philip Fowler, Joseph Goose, Richard J. Gowers, Lukas Grossar, Abhinav Gupta, Benjamin Hall, Kyle J. Huston, Joe Jordan, Max Linke, Jinju Lu, Robert McGibbon, Manuel Nuno Melo, Alex Nesterenko, Hai Nguyen, Mattia F. Palermo, Danny Parton, Joshua L. Phillips, Tyler Reddy, Paul Rigor, Carlos Yanez S., Utkarsh Saxena, Sean L. Seyler, Andy Somogyi, Caio S. Souza, Lukas Stelzl, Gorman Stock, Isaac Virshup, Zhuyi Xue, and Oliver Beckstein.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>